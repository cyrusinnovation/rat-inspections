<!doctype html>
<html>
	<head>
		<title>Rat Inspections</title>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
		<script src="bower_components/pegasus/dist/pegasus.min.js"></script>
		<style type="text/css" media="screen">
			#map {
				height: 800px;
			}	
		</style>
	</head>
	<body>
		<div id="map"></div>

		<script>
		  var request = pegasus('shapefiles/active_manhattan.geojson');
		</script>
		<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
		<script src="http://d3js.org/d3.v3.min.js"></script>
		<script src="http://d3js.org/colorbrewer.v1.min.js"></script>
		<script>
			var map = L.map('map').setView([40.74023, -73.96202], 12);
	    	var Stamen_TonerLite = L.tileLayer('http://{s}.tile.stamen.com/toner-lite/{z}/{x}/{y}.png', {
				attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
				subdomains: 'abcd',
				minZoom: 10,
				maxZoom: 20
			});
			Stamen_TonerLite.addTo(map);

			var colorScale = d3.scale.linear()
			    .domain([10,40])
    			.range(colorbrewer.Reds[3]);

			request.then(
				// success handler
				function(data, xhr) {
					console.log('Loading geoJson data');
					L.geoJson(data, {
						style: function (feature) {
							var feature_color = colorScale(feature.properties.ActiveCount);
							return {
								color: feature_color,
								fillColor: feature_color,
							    "weight": 1,
							    "opacity": 1,
							    fillOpacity: 0.9
							};
						}
					}).addTo(map);
				},
				// error handler
				function(data, xhr) {
					console.error(data, xhr.status);
				}
			);

		</script>
	</body>
</html>